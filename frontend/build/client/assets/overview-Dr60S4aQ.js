import{w as cs,c as ie}from"./index-CiLVYEwt.js";import{j as e,r as o}from"./catchall-DRODuvbv.js";import{u as ds,b as us,g as De,c as we,e as hs,h as ms}from"./index-DhH_ZBC8.js";import{C as Q,u as xs,A as ps,T as fs,a as js,b as re,c as P,d as gs,e as M,E as vs,g as ys,h as ws,i as Ns,j as bs}from"./table-dz0QsdU7.js";import{u as Ae,t as z}from"./AuthContext-DaAjC7CZ.js";import{c as q,s as le}from"./createLucideIcon-CEFgt_Ga.js";import{c as Cs,B as v}from"./button-DQSlb20C.js";import{R as ks,T as _s,C as Ss,f as ze,g as Rs,h as Fs,P as Ms,O as Ds,k as qe,l as As,I as zs,i as qs,D as Ne,a as be,b as Ce,d as T,e as Ps}from"./dropdown-menu-BswiM50g.js";import{I as H}from"./label-CbLlOEyM.js";import{c as S}from"./utils-CDN07tui.js";import{C as D,a as G,c as L,d as A,b as Ts}from"./card-DTOgLEzj.js";import{T as ce,F as ne}from"./index-wRzQt9Q5.js";import{X as Pe,P as Es}from"./x-58R_Chr7.js";import{d as U,F as Te,a as g,b as p,c as X}from"./field-3A_m1d7x.js";import{m as Is,b as Gs,c as Ee,P as Y,d as de,p as Hs}from"./index-rF36wCKm.js";import{u as he}from"./index-olsFugHa.js";import{S as oe}from"./separator-_L2rgyuV.js";import{S as Bs,P as ke}from"./search-BskTmzzA.js";import{T as Ls}from"./target-BGb18Bjt.js";const Os=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]],_e=q("archive-restore",Os);const Vs=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Se=q("archive",Vs);const $s=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Us=q("calendar",$s);const Ks=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ws=q("circle",Ks);const Qs=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Xs=q("funnel",Qs);const Ys=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],Zs=q("layout-grid",Ys);const Js=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],et=q("list",Js);const st=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],Re=q("pause",st);const tt=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],Fe=q("play",tt);function Ie({...t}){return e.jsx(ks,{"data-slot":"dialog",...t})}function at({...t}){return e.jsx(_s,{"data-slot":"dialog-trigger",...t})}function it({...t}){return e.jsx(Ms,{"data-slot":"dialog-portal",...t})}function Ge({...t}){return e.jsx(ze,{"data-slot":"dialog-close",...t})}function rt({className:t,...a}){return e.jsx(Ds,{"data-slot":"dialog-overlay",className:S("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function He({className:t,children:a,showCloseButton:l=!0,...m}){return e.jsxs(it,{"data-slot":"dialog-portal",children:[e.jsx(rt,{}),e.jsxs(Ss,{"data-slot":"dialog-content",className:S("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...m,children:[a,l&&e.jsxs(ze,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Pe,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Be({className:t,...a}){return e.jsx("div",{"data-slot":"dialog-header",className:S("flex flex-col gap-2 text-center sm:text-left",t),...a})}function Le({className:t,...a}){return e.jsx("div",{"data-slot":"dialog-footer",className:S("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function Oe({className:t,...a}){return e.jsx(Rs,{"data-slot":"dialog-title",className:S("text-lg leading-none font-semibold",t),...a})}function Ve({className:t,...a}){return e.jsx(Fs,{"data-slot":"dialog-description",className:S("text-muted-foreground text-sm",t),...a})}const nt=Cs("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function O({className:t,variant:a,...l}){return e.jsx("div",{className:S(nt({variant:a}),t),...l})}var me="Radio",[ot,$e]=Ee(me),[lt,ct]=ot(me),Ue=o.forwardRef((t,a)=>{const{__scopeRadio:l,name:m,checked:i=!1,required:c,disabled:h,value:x="on",onCheck:y,form:f,...d}=t,[u,N]=o.useState(null),j=he(a,b=>N(b)),w=o.useRef(!1),k=u?f||!!u.closest("form"):!0;return e.jsxs(lt,{scope:l,checked:i,disabled:h,children:[e.jsx(Y.button,{type:"button",role:"radio","aria-checked":i,"data-state":Xe(i),"data-disabled":h?"":void 0,disabled:h,value:x,...d,ref:j,onClick:de(t.onClick,b=>{i||y?.(),k&&(w.current=b.isPropagationStopped(),w.current||b.stopPropagation())})}),k&&e.jsx(Qe,{control:u,bubbles:!w.current,name:m,value:x,checked:i,required:c,disabled:h,form:f,style:{transform:"translateX(-100%)"}})]})});Ue.displayName=me;var Ke="RadioIndicator",We=o.forwardRef((t,a)=>{const{__scopeRadio:l,forceMount:m,...i}=t,c=ct(Ke,l);return e.jsx(qs,{present:m||c.checked,children:e.jsx(Y.span,{"data-state":Xe(c.checked),"data-disabled":c.disabled?"":void 0,...i,ref:a})})});We.displayName=Ke;var dt="RadioBubbleInput",Qe=o.forwardRef(({__scopeRadio:t,control:a,checked:l,bubbles:m=!0,...i},c)=>{const h=o.useRef(null),x=he(h,c),y=ds(l),f=Hs(a);return o.useEffect(()=>{const d=h.current;if(!d)return;const u=window.HTMLInputElement.prototype,j=Object.getOwnPropertyDescriptor(u,"checked").set;if(y!==l&&j){const w=new Event("click",{bubbles:m});j.call(d,l),d.dispatchEvent(w)}},[y,l,m]),e.jsx(Y.input,{type:"radio","aria-hidden":!0,defaultChecked:l,...i,tabIndex:-1,ref:x,style:{...i.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Qe.displayName=dt;function Xe(t){return t?"checked":"unchecked"}var ut=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Z="RadioGroup",[ht]=Ee(Z,[qe,$e]),Ye=qe(),Ze=$e(),[mt,xt]=ht(Z),Je=o.forwardRef((t,a)=>{const{__scopeRadioGroup:l,name:m,defaultValue:i,value:c,required:h=!1,disabled:x=!1,orientation:y,dir:f,loop:d=!0,onValueChange:u,...N}=t,j=Ye(l),w=Is(f),[k,b]=Gs({prop:c,defaultProp:i??null,onChange:u,caller:Z});return e.jsx(mt,{scope:l,name:m,required:h,disabled:x,value:k,onValueChange:b,children:e.jsx(As,{asChild:!0,...j,orientation:y,dir:w,loop:d,children:e.jsx(Y.div,{role:"radiogroup","aria-required":h,"aria-orientation":y,"data-disabled":x?"":void 0,dir:w,...N,ref:a})})})});Je.displayName=Z;var es="RadioGroupItem",ss=o.forwardRef((t,a)=>{const{__scopeRadioGroup:l,disabled:m,...i}=t,c=xt(es,l),h=c.disabled||m,x=Ye(l),y=Ze(l),f=o.useRef(null),d=he(a,f),u=c.value===i.value,N=o.useRef(!1);return o.useEffect(()=>{const j=k=>{ut.includes(k.key)&&(N.current=!0)},w=()=>N.current=!1;return document.addEventListener("keydown",j),document.addEventListener("keyup",w),()=>{document.removeEventListener("keydown",j),document.removeEventListener("keyup",w)}},[]),e.jsx(zs,{asChild:!0,...x,focusable:!h,active:u,children:e.jsx(Ue,{disabled:h,required:c.required,checked:u,...y,...i,name:c.name,ref:d,onCheck:()=>c.onValueChange(i.value),onKeyDown:de(j=>{j.key==="Enter"&&j.preventDefault()}),onFocus:de(i.onFocus,()=>{N.current&&f.current?.click()})})})});ss.displayName=es;var pt="RadioGroupIndicator",ts=o.forwardRef((t,a)=>{const{__scopeRadioGroup:l,...m}=t,i=Ze(l);return e.jsx(We,{...i,...m,ref:a})});ts.displayName=pt;var ft=Je,jt=ss,gt=ts;function ue({className:t,...a}){return e.jsx(ft,{"data-slot":"radio-group",className:S("grid gap-3",t),...a})}function E({className:t,...a}){return e.jsx(jt,{"data-slot":"radio-group-item",className:S("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:e.jsx(gt,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(Ws,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}function as({className:t,...a}){return e.jsx("textarea",{"data-slot":"textarea",className:S("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}const Me={name:"ex. drink more water",description:"Optionally include a brief description...",status:"active",unit:"unit",frequency:"daily",goal:0,reminder_time:null,is_archived:!1};function vt({isOpen:t,open:a,setHabits:l}){const{user:m}=Ae(),[i,c]=o.useState(Me),h=f=>{c(d=>({...d,frequency:f}))},x=f=>{const{name:d,value:u,type:N}=f.target;c(j=>({...j,[d]:d==="goal"?Number(u):u}))},y=async f=>{if(f.preventDefault(),!m||i===Me)return;const d=new ce().toISOString().split("T")[0];try{await us({user_id:m.id,name:i.name,description:i.description==="Optionally include a brief description..."?"":i.description,status:"active",unit:i.unit,frequency:i.frequency,goal:i.goal,reminder_time:null,is_archived:!1}),l(u=>[...u,{...i,created_at:d}]),t(!1),z.success("Successfully added a new habit.")}catch{z.error("Failed to create.")}};return e.jsx(e.Fragment,{children:e.jsx(Ie,{open:a,onOpenChange:t,children:e.jsxs("form",{children:[e.jsx(at,{asChild:!0,children:e.jsxs(v,{variant:"outline",children:[e.jsx(Es,{})," Habit"]})}),e.jsxs(He,{className:"sm:max-w-[425px]",children:[e.jsxs(Be,{children:[e.jsx(Oe,{children:"Create a new Habit."}),e.jsx(Ve,{children:"Fill out the form here. Click create when you're done."})]}),e.jsx("div",{className:"w-full max-w-md",children:e.jsx(U,{children:e.jsxs(Te,{children:[e.jsxs(g,{children:[e.jsx(p,{htmlFor:"name",children:"Habit Name"}),e.jsx(H,{id:"name",name:"name",type:"text",placeholder:"ex. drink more water",onChange:x,required:!0}),e.jsx(X,{children:"Choose the name of your new habit."})]}),e.jsxs(g,{children:[e.jsx(p,{htmlFor:"feedback",children:"Description"}),e.jsx(as,{id:"description",name:"description",placeholder:"Optionally include a brief description...",rows:4,onChange:x})]}),e.jsxs(U,{children:[e.jsx(p,{children:"Frequency Plan"}),e.jsx(X,{children:"Select how frequent you plan to perform this habit."}),e.jsxs(ue,{name:"frequency",defaultValue:"daily",onValueChange:h,required:!0,children:[e.jsxs(g,{orientation:"horizontal",children:[e.jsx(E,{value:"daily",id:"plan-daily"}),e.jsx(p,{htmlFor:"plan-daily",className:"font-normal",children:"Daily"})]}),e.jsxs(g,{orientation:"horizontal",children:[e.jsx(E,{value:"weekly",id:"plan-weekly"}),e.jsx(p,{htmlFor:"plan-weekly",className:"font-normal",children:"Weekly"})]}),e.jsxs(g,{orientation:"horizontal",children:[e.jsx(E,{value:"monthly",id:"plan-monthly"}),e.jsx(p,{htmlFor:"plan-monthly",className:"font-normal",children:"Monthly"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(g,{children:[e.jsx(p,{htmlFor:"city",children:"Frequency Goal"}),e.jsx(H,{id:"goal",name:"goal",type:"number",min:0,placeholder:"0",onChange:x,required:!0})]}),e.jsxs(g,{children:[e.jsx(p,{htmlFor:"unit",children:"Unit To Measure"}),e.jsx(H,{id:"unit",name:"unit",type:"text",placeholder:"ex. ounces or oz",onChange:x,required:!0})]})]})]})})}),e.jsxs(Le,{children:[e.jsx(Ge,{asChild:!0,children:e.jsx(v,{variant:"outline",children:"Cancel"})}),e.jsx(v,{type:"submit",onClick:y,children:"Create Habit"})]})]})]})})})}function yt({habit:t,open:a,onOpenChange:l,onSave:m}){const[i,c]=o.useState({name:t.name,description:t.description||"",status:t.status,unit:t.unit,frequency:t.frequency||"daily",goal:t.goal||0,reminder_time:t.reminder_time,is_archived:t.is_archived});o.useEffect(()=>{a&&c({name:t.name,description:t.description||"",status:t.status,unit:t.unit,frequency:t.frequency||"daily",goal:t.goal||0,reminder_time:t.reminder_time,is_archived:t.is_archived})},[t,a]);const h=d=>{c(u=>({...u,frequency:d}))},x=d=>{const{name:u,value:N,type:j}=d.target;c(w=>({...w,[u]:u==="goal"?Number(N):N}))},y=d=>{c(u=>({...u,status:d}))},f=async d=>{d.preventDefault();const u={...t,...i};m(u)};return e.jsx(Ie,{open:a,onOpenChange:l,children:e.jsx("form",{onSubmit:f,children:e.jsxs(He,{className:"sm:max-w-[425px]",children:[e.jsxs(Be,{children:[e.jsx(Oe,{children:"Edit Habit"}),e.jsx(Ve,{children:"Update your habit details below. Click save when you're done."})]}),e.jsx("div",{className:"w-full max-w-md",children:e.jsx(U,{children:e.jsxs(Te,{children:[e.jsxs(g,{children:[e.jsx(p,{htmlFor:"edit-name",children:"Habit Name"}),e.jsx(H,{id:"edit-name",name:"name",type:"text",value:i.name,onChange:x,required:!0}),e.jsx(X,{children:"The name of your habit."})]}),e.jsxs(g,{children:[e.jsx(p,{htmlFor:"edit-description",children:"Description"}),e.jsx(as,{id:"edit-description",name:"description",placeholder:"Optional description...",rows:4,value:i.description,onChange:x})]}),e.jsxs(U,{children:[e.jsx(p,{children:"Frequency Plan"}),e.jsx(X,{children:"Select how frequent you plan to perform this habit."}),e.jsxs(ue,{name:"frequency",value:i.frequency||"daily",onValueChange:h,required:!0,children:[e.jsxs(g,{orientation:"horizontal",children:[e.jsx(E,{value:"daily",id:"edit-plan-daily"}),e.jsx(p,{htmlFor:"edit-plan-daily",className:"font-normal",children:"Daily"})]}),e.jsxs(g,{orientation:"horizontal",children:[e.jsx(E,{value:"weekly",id:"edit-plan-weekly"}),e.jsx(p,{htmlFor:"edit-plan-weekly",className:"font-normal",children:"Weekly"})]}),e.jsxs(g,{orientation:"horizontal",children:[e.jsx(E,{value:"monthly",id:"edit-plan-monthly"}),e.jsx(p,{htmlFor:"edit-plan-monthly",className:"font-normal",children:"Monthly"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(g,{children:[e.jsx(p,{htmlFor:"edit-goal",children:"Frequency Goal"}),e.jsx(H,{id:"edit-goal",name:"goal",type:"number",min:0,value:i.goal||0,onChange:x,required:!0})]}),e.jsxs(g,{children:[e.jsx(p,{htmlFor:"edit-unit",children:"Unit To Measure"}),e.jsx(H,{id:"edit-unit",name:"unit",type:"text",value:i.unit,onChange:x,required:!0})]})]}),e.jsxs(U,{children:[e.jsx(p,{children:"Status"}),e.jsxs(ue,{value:i.status,onValueChange:y,children:[e.jsxs(g,{orientation:"horizontal",children:[e.jsx(E,{value:"active",id:"edit-status-active"}),e.jsx(p,{htmlFor:"edit-status-active",className:"font-normal",children:"Active"})]}),e.jsxs(g,{orientation:"horizontal",children:[e.jsx(E,{value:"inactive",id:"edit-status-inactive"}),e.jsx(p,{htmlFor:"edit-status-inactive",className:"font-normal",children:"Inactive"})]})]})]}),e.jsxs(g,{orientation:"horizontal",className:"items-center gap-2",children:[e.jsx(Q,{id:"edit-archived",checked:i.is_archived,onCheckedChange:d=>c(u=>({...u,is_archived:!!d}))}),e.jsx(p,{htmlFor:"edit-archived",className:"font-normal cursor-pointer",children:"Archive this habit"})]})]})})}),e.jsxs(Le,{children:[e.jsx(Ge,{asChild:!0,children:e.jsx(v,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(v,{type:"submit",children:"Save Changes"})]})]})})})}async function Bt(){const{data:{user:t}}=await le.auth.getUser();if(!t)return;const a=await De(t.id),{data:l}=await le.rpc("get_habit_dashboard_stats",{p_user_id:t.id});return{habits:a??[],stats:l??[]}}const wt=({loaderData:t})=>{const{user:a}=Ae(),[l,m]=o.useState(!1),[i,c]=o.useState(t.habits??[]),[h,x]=o.useState(t.stats??[]),[y,f]=o.useState([]),[d,u]=o.useState([]),[N,j]=o.useState({}),[w,k]=o.useState({}),[b,xe]=o.useState(""),[R,K]=o.useState("all"),[V,pe]=o.useState("table"),[J,W]=o.useState(null),B=o.useMemo(()=>{let s=i;if(R==="active"?s=s.filter(r=>r.status==="active"&&!r.is_archived):R==="inactive"?s=s.filter(r=>r.status==="inactive"&&!r.is_archived):R==="archived"&&(s=s.filter(r=>r.is_archived)),b){const r=b.toLowerCase();s=s.filter(n=>n.name.toLowerCase().includes(r)||n.description?.toLowerCase().includes(r)||n.unit.toLowerCase().includes(r))}return s},[i,b,R]),[fe,je]=o.useState(new Set),is=s=>{je(r=>{const n=new Set(r);return n.has(s)?n.delete(s):n.add(s),n})},ee=()=>{je(new Set)},I=xs({data:B,columns:[],onSortingChange:f,onColumnFiltersChange:u,getCoreRowModel:bs(),getPaginationRowModel:Ns(),getSortedRowModel:ws(),getFilteredRowModel:ys(),onColumnVisibilityChange:j,onRowSelectionChange:k,enableRowSelection:!0,getRowId:s=>s.id,state:{sorting:y,columnFilters:d,columnVisibility:N,rowSelection:w}}),ge=B.filter(s=>fe.has(s.id)),ve=V==="table"?I.getFilteredSelectedRowModel().rows.length:ge.length,se=V==="table"?I.getFilteredSelectedRowModel().rows.map(s=>s.original):ge,rs=async()=>{if(!a)return;const s=se.map(r=>r.id);await hs(s),c(r=>r.filter(n=>!s.includes(n.id))),k({}),ee(),z.success("Habit(s) deleted")},te=async(s,r)=>{if(!a)return;const n=r?[r]:se.map(C=>C.id);if(n.length!==0)try{await we(n,{is_archived:s}),c(C=>C.map(_=>n.includes(_.id)?{..._,is_archived:s}:_)),k({}),ee(),z.success(`${s?"Archived":"Unarchived"} ${n.length} habit(s)`)}catch{z.error("Failed to update habits")}},ae=async(s,r)=>{if(!a)return;const n=r?[r]:se.map(C=>C.id);if(n.length!==0)try{await we(n,{status:s}),c(C=>C.map(_=>n.includes(_.id)?{..._,status:s}:_)),k({}),ee(),z.success(`Updated ${n.length} habit(s) to ${s}`)}catch{z.error("Failed to update habits")}},ns=async s=>{if(a)try{await ms(s.id,{name:s.name,description:s.description,status:s.status,unit:s.unit,frequency:s.frequency,goal:s.goal,reminder_time:s.reminder_time,is_archived:s.is_archived}),c(r=>r.map(n=>n.id===s.id?s:n)),W(null),z.success("Habit updated successfully")}catch{z.error("Failed to update habit")}},ye=s=>h.find(r=>r.habit_id===s),os=async()=>{if(!a)return;const s=await De(a.id);c(s);const{data:r}=await le.rpc("get_habit_dashboard_stats",{p_user_id:a.id});x(r??[])};o.useEffect(()=>{i.length===0&&m(!0)},[]);const $=o.useMemo(()=>{const s=i.filter(F=>F.status==="active"&&!F.is_archived).length,r=i.filter(F=>F.status==="inactive"&&!F.is_archived).length,n=i.filter(F=>F.is_archived).length,C=i.length,_=h.length>0?Math.round(h.reduce((F,ls)=>F+(ls.current_streak??0),0)/h.length):0;return{active:s,inactive:r,archived:n,total:C,avgStreak:_}},[i,h]);return e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"scroll-m-20 text-3xl font-semibold tracking-tight",children:"Habit Management"}),e.jsx("p",{className:"leading-7 text-muted-foreground mt-2",children:"Organize, configure, and manage all your habits in one place."})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsxs(D,{children:[e.jsx(G,{className:"pb-2",children:e.jsx(L,{children:"Total Habits"})}),e.jsx(A,{children:e.jsx("div",{className:"text-2xl font-bold",children:$.total})})]}),e.jsxs(D,{children:[e.jsx(G,{className:"pb-2",children:e.jsx(L,{children:"Active"})}),e.jsx(A,{children:e.jsx("div",{className:"text-2xl font-bold text-primary",children:$.active})})]}),e.jsxs(D,{children:[e.jsx(G,{className:"pb-2",children:e.jsx(L,{children:"Inactive"})}),e.jsx(A,{children:e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:$.inactive})})]}),e.jsxs(D,{children:[e.jsx(G,{className:"pb-2",children:e.jsx(L,{children:"Archived"})}),e.jsx(A,{children:e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:$.archived})})]}),e.jsxs(D,{children:[e.jsx(G,{className:"pb-2",children:e.jsx(L,{children:"Avg Streak"})}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"h-4 w-4 text-chart-4"}),e.jsx("span",{className:"text-2xl font-bold",children:$.avgStreak})]})})]})]}),e.jsxs(D,{children:[e.jsx(G,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex gap-2 items-center w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Bs,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(H,{placeholder:"Search habits...",value:b,onChange:s=>xe(s.target.value),className:"pl-8"}),b&&e.jsx(v,{variant:"ghost",size:"icon",className:"absolute right-1 top-1 h-7 w-7",onClick:()=>xe(""),children:e.jsx(Pe,{className:"h-4 w-4"})})]}),e.jsxs(Ne,{children:[e.jsx(be,{asChild:!0,children:e.jsxs(v,{variant:"outline",size:"sm",children:[e.jsx(Xs,{className:"h-4 w-4 mr-2"}),R==="all"?"All":R.charAt(0).toUpperCase()+R.slice(1)]})}),e.jsxs(Ce,{children:[e.jsx(T,{onClick:()=>K("all"),children:"All Habits"}),e.jsx(T,{onClick:()=>K("active"),children:"Active"}),e.jsx(T,{onClick:()=>K("inactive"),children:"Inactive"}),e.jsx(T,{onClick:()=>K("archived"),children:"Archived"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex border rounded-md",children:[e.jsx(v,{variant:V==="table"?"default":"ghost",size:"sm",className:"rounded-r-none",onClick:()=>pe("table"),children:e.jsx(et,{className:"h-4 w-4"})}),e.jsx(v,{variant:V==="grid"?"default":"ghost",size:"sm",className:"rounded-l-none",onClick:()=>pe("grid"),children:e.jsx(Zs,{className:"h-4 w-4"})})]}),e.jsx(vt,{open:l,isOpen:m,setHabits:async()=>{await os()}})]})]})}),ve>0&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{}),e.jsx(A,{className:"pt-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[ve," habit(s) selected"]}),e.jsx(oe,{orientation:"vertical",className:"h-4"}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>ae("active"),children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Activate"]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>ae("inactive"),children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Deactivate"]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>te(!0),children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Archive"]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>te(!1),children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Unarchive"]}),e.jsx(oe,{orientation:"vertical",className:"h-4"}),e.jsx(ps,{onContinue:rs,variant:"destructive",dialingDesc:"This action cannot be undone. All selected habits will be permanently deleted.",buttonText:"Delete"})]})})]})]}),V==="table"?e.jsx(D,{children:e.jsx(A,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(fs,{children:[e.jsx(js,{children:e.jsxs(re,{children:[e.jsx(P,{className:"w-12",children:e.jsx(Q,{checked:I.getIsAllPageRowsSelected(),onCheckedChange:s=>I.toggleAllPageRowsSelected(!!s),"aria-label":"Select all"})}),e.jsx(P,{children:"Habit"}),e.jsx(P,{children:"Goal"}),e.jsx(P,{children:"Frequency"}),e.jsx(P,{children:"Status"}),e.jsx(P,{children:"Stats"}),e.jsx(P,{children:"Created"}),e.jsx(P,{className:"w-12"})]})}),e.jsx(gs,{children:B.length>0?B.map(s=>{const r=ye(s.id);return e.jsxs(re,{"data-state":I.getRowModel().rows.some(n=>n.original.id===s.id&&n.getIsSelected())&&"selected",className:s.is_archived?"opacity-60":"",children:[e.jsx(M,{children:e.jsx(Q,{checked:I.getRowModel().rows.some(n=>n.original.id===s.id&&n.getIsSelected()),onCheckedChange:n=>{const C=I.getRowModel().rows.find(_=>_.original.id===s.id);C&&C.toggleSelected(!!n)}})}),e.jsx(M,{children:e.jsxs("div",{children:[e.jsx(ie,{to:`/dashboard/habits/${s.id}`,className:"font-medium capitalize hover:underline",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:s.description})]})}),e.jsx(M,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ls,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:[s.goal??0," ",s.unit]})]})}),e.jsx(M,{children:e.jsx(O,{variant:"outline",className:"capitalize",children:s.frequency??"N/A"})}),e.jsx(M,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(O,{variant:s.status==="active"?"default":"secondary",className:"w-fit capitalize",children:s.status}),s.is_archived&&e.jsx(O,{variant:"outline",className:"w-fit text-xs",children:"Archived"})]})}),e.jsx(M,{children:r?e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.current_streak>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"h-3 w-3 text-chart-4"}),e.jsx("span",{children:r.current_streak})]}),e.jsxs("span",{className:"text-muted-foreground",children:[r.week_completion??0,"% week"]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No data"})}),e.jsx(M,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(Us,{className:"h-3 w-3"}),new ce(s.created_at).toLocaleDateString()]})}),e.jsx(M,{children:e.jsxs(Ne,{children:[e.jsx(be,{asChild:!0,children:e.jsx(v,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(vs,{className:"h-4 w-4"})})}),e.jsxs(Ce,{align:"end",children:[e.jsxs(T,{onClick:()=>W(s),children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(T,{asChild:!0,children:e.jsx(ie,{to:`/dashboard/habits/${s.id}`,children:"View Details"})}),e.jsx(Ps,{}),e.jsx(T,{onClick:()=>ae(s.status==="active"?"inactive":"active",s.id),children:s.status==="active"?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Deactivate"]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Activate"]})}),e.jsx(T,{onClick:()=>te(!s.is_archived,s.id),children:s.is_archived?e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Unarchive"]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Archive"]})})]})]})})]},s.id)}):e.jsx(re,{children:e.jsxs(M,{colSpan:8,className:"h-24 text-center",children:["No habits found. ",b||R!=="all"?"Try adjusting your filters.":"Create your first habit to get started!"]})})})]})})})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:B.length>0?B.map(s=>{const r=ye(s.id),n=fe.has(s.id);return e.jsxs(D,{className:s.is_archived?"opacity-60":"",children:[e.jsx(G,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Ts,{className:"capitalize",children:s.name}),s.description&&e.jsx(L,{className:"mt-1 line-clamp-2",children:s.description})]}),e.jsx(Q,{checked:n,onCheckedChange:()=>is(s.id)})]})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(O,{variant:s.status==="active"?"default":"secondary",className:"capitalize",children:s.status}),s.is_archived&&e.jsx(O,{variant:"outline",children:"Archived"}),e.jsx(O,{variant:"outline",className:"capitalize",children:s.frequency??"N/A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Goal"}),e.jsxs("span",{className:"font-medium",children:[s.goal??0," ",s.unit]})]}),r&&e.jsxs(e.Fragment,{children:[r.current_streak>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Current Streak"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"h-3 w-3 text-chart-4"}),e.jsxs("span",{className:"font-medium",children:[r.current_streak," days"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Week Completion"}),e.jsxs("span",{className:"font-medium",children:[r.week_completion??0,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Created"}),e.jsx("span",{className:"font-medium",children:new ce(s.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(v,{variant:"outline",size:"sm",className:"flex-1",asChild:!0,children:e.jsx(ie,{to:`/dashboard/habits/${s.id}`,children:"View Details"})}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>W(s),children:e.jsx(ke,{className:"h-4 w-4"})})]})]})]},s.id)}):e.jsx(D,{className:"col-span-full",children:e.jsx(A,{className:"py-12 text-center",children:e.jsxs("p",{className:"text-muted-foreground",children:["No habits found. ",b||R!=="all"?"Try adjusting your filters.":"Create your first habit to get started!"]})})})}),J&&e.jsx(yt,{habit:J,open:!!J,onOpenChange:s=>!s&&W(null),onSave:ns})]})},Lt=cs(wt);export{Bt as clientLoader,Lt as default};
