import{w as N}from"./index-CiLVYEwt.js";import{R as D,r as i,j as e}from"./catchall-DRODuvbv.js";import{f as k,a as F,d as P}from"./index-DhH_ZBC8.js";import{c as T,s as I}from"./createLucideIcon-CEFgt_Ga.js";import{u as A,A as H,T as E,a as _,b as d,c as B,f as g,d as V,e as u,g as z,h as K,i as L,j as O,C as m,E as U}from"./table-dz0QsdU7.js";import{B as r}from"./button-DQSlb20C.js";import{D as $,a as q,b as G,c as J,d as Q,e as W}from"./dropdown-menu-BswiM50g.js";import{u as X,t as Y}from"./AuthContext-DaAjC7CZ.js";import{C as Z}from"./ChartAreaInteractive-CYRgHSG6.js";import"./index-rF36wCKm.js";import"./index-olsFugHa.js";import"./utils-CDN07tui.js";import"./card-DTOgLEzj.js";import"./index-CmlK_pLt.js";const ee=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],te=T("arrow-up-down",ee);async function pe({params:t}){const{data:{user:o}}=await I.auth.getUser();if(!o)return;const n=await k(o.id,t.habitId);return{habit:await F(t.habitId),entries:n}}const x=[{id:"select",header:({table:t})=>e.jsx(m,{checked:t.getIsAllPageRowsSelected()||t.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:o=>t.toggleAllPageRowsSelected(!!o),"aria-label":"Select all"}),cell:({row:t})=>e.jsx(m,{checked:t.getIsSelected(),onCheckedChange:o=>{t.toggleSelected(!!o)},"aria-label":"Select row"}),enableSorting:!1,enableHiding:!1},{accessorKey:"entry_date",header:"Date",cell:({row:t})=>e.jsx("div",{className:"capitalize",children:t.getValue("entry_date")})},{accessorKey:"value",header:({column:t})=>e.jsxs(r,{variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Amount",e.jsx(te,{})]}),cell:({row:t})=>e.jsx("div",{className:"lowercase pl-8",children:t.getValue("value")})},{accessorKey:"notes",header:()=>e.jsx("div",{className:"",children:"Notes"}),cell:({row:t})=>e.jsx("div",{className:" font-semibold text-slate-500",children:t.getValue("notes")})},{id:"actions",enableHiding:!1,cell:({row:t})=>{const o=t.original;return e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(r,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(U,{})]})}),e.jsxs(G,{align:"end",children:[e.jsx(J,{children:"Actions"}),e.jsx(Q,{onClick:()=>navigator.clipboard.writeText(o.id),children:"Copy Entry ID"}),e.jsx(W,{})]})]})}}],se=({loaderData:t})=>{const{user:o}=X(),[n,c]=D.useState(t.entries),[w,p]=i.useState([]),[j,b]=i.useState([]),[f,v]=i.useState({}),[C,h]=i.useState({}),l=A({data:n,columns:x,onSortingChange:p,onColumnFiltersChange:b,getCoreRowModel:O(),getPaginationRowModel:L(),getSortedRowModel:K(),getFilteredRowModel:z(),onColumnVisibilityChange:v,onRowSelectionChange:h,state:{sorting:w,columnFilters:j,columnVisibility:f,rowSelection:C}}),S=async()=>{if(!o)return;const a=l.getFilteredSelectedRowModel().rows.map(s=>s.original.id);await P(a),c(s=>s.filter(R=>!a.find(M=>M===R.id))),h({}),Y.success("Habit Entry deleted")},y=n.reduce((a,s)=>(a[s.entry_date]?a[s.entry_date].value+=s.value:a[s.entry_date]={date:s.entry_date,value:s.value},a),{});return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"mb-8 flex-wrap",children:[e.jsx("p",{className:"text-muted-foreground text-lg",children:"Habit"}),e.jsx("h1",{className:"scroll-m-20 capitalize text-4xl font-extrabold tracking-tight text-balance",children:t.habit})]}),e.jsx("div",{children:e.jsx(Z,{chartData:Object.values(y).sort((a,s)=>new Date(a.date).getTime()-new Date(s.date).getTime())})}),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"flex items-center py-4",children:e.jsx("div",{className:"ml-auto",children:e.jsx(H,{onContinue:S,variant:l.getFilteredSelectedRowModel().rows.length>0?"destructive":"outline",disabled:l.getFilteredSelectedRowModel().rows.length<=0,dialingDesc:"Action cannot be undone.",buttonText:`Delete ${l.getFilteredSelectedRowModel().rows.length>0?`Batch (${l.getFilteredSelectedRowModel().rows.length} rows)`:""}`})})}),e.jsx("div",{className:"overflow-hidden rounded-md border",children:e.jsxs(E,{children:[e.jsx(_,{children:l.getHeaderGroups().map(a=>e.jsx(d,{children:a.headers.map(s=>e.jsx(B,{children:s.isPlaceholder?null:g(s.column.columnDef.header,s.getContext())},s.id))},a.id))}),e.jsx(V,{children:l.getRowModel().rows?.length?l.getRowModel().rows.map(a=>e.jsx(d,{"data-state":a.getIsSelected()&&"selected",children:a.getVisibleCells().map(s=>e.jsx(u,{children:g(s.column.columnDef.cell,s.getContext())},s.id))},a.id)):e.jsx(d,{children:e.jsx(u,{colSpan:x.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsxs("div",{className:"text-muted-foreground flex-1 text-sm",children:[l.getFilteredSelectedRowModel().rows.length," of"," ",l.getFilteredRowModel().rows.length," row(s) selected."]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>l.previousPage(),disabled:!l.getCanPreviousPage(),children:"Previous"}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>l.nextPage(),disabled:!l.getCanNextPage(),children:"Next"})]})]})]})]})},je=N(se);export{pe as clientLoader,je as default};
