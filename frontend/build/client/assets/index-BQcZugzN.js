function N(e,t,n="long"){return new Intl.DateTimeFormat("en-US",{hour:"numeric",timeZone:e,timeZoneName:n}).format(t).split(/\s/g).slice(2).join(" ")}const b={},c={};function r(e,t){try{const s=(b[e]||=new Intl.DateTimeFormat("en-US",{timeZone:e,timeZoneName:"longOffset"}).format)(t).split("GMT")[1];return s in c?c[s]:C(s,s.split(":"))}catch{if(e in c)return c[e];const n=e?.match(F);return n?C(e,n.slice(1)):NaN}}const F=/([+-]\d\d):?(\d\d)?/;function C(e,t){const n=+(t[0]||0),s=+(t[1]||0),o=+(t[2]||0)/60;return c[e]=n*60+s>0?n*60+s+o:n*60-s-o}class i extends Date{constructor(...t){super(),t.length>1&&typeof t[t.length-1]=="string"&&(this.timeZone=t.pop()),this.internal=new Date,isNaN(r(this.timeZone,this))?this.setTime(NaN):t.length?typeof t[0]=="number"&&(t.length===1||t.length===2&&typeof t[1]!="number")?this.setTime(t[0]):typeof t[0]=="string"?this.setTime(+new Date(t[0])):t[0]instanceof Date?this.setTime(+t[0]):(this.setTime(+new Date(...t)),w(this),g(this)):this.setTime(Date.now())}static tz(t,...n){return n.length?new i(...n,t):new i(Date.now(),t)}withTimeZone(t){return new i(+this,t)}getTimezoneOffset(){const t=-r(this.timeZone,this);return t>0?Math.floor(t):Math.ceil(t)}setTime(t){return Date.prototype.setTime.apply(this,arguments),g(this),+this}[Symbol.for("constructDateFrom")](t){return new i(+new Date(t),this.timeZone)}}const U=/^(get|set)(?!UTC)/;Object.getOwnPropertyNames(Date.prototype).forEach(e=>{if(!U.test(e))return;const t=e.replace(U,"$1UTC");i.prototype[t]&&(e.startsWith("get")?i.prototype[e]=function(){return this.internal[t]()}:(i.prototype[e]=function(){return Date.prototype[t].apply(this.internal,arguments),H(this),+this},i.prototype[t]=function(){return Date.prototype[t].apply(this,arguments),g(this),+this}))});function g(e){e.internal.setTime(+e),e.internal.setUTCSeconds(e.internal.getUTCSeconds()-Math.round(-r(e.timeZone,e)*60))}function H(e){Date.prototype.setFullYear.call(e,e.internal.getUTCFullYear(),e.internal.getUTCMonth(),e.internal.getUTCDate()),Date.prototype.setHours.call(e,e.internal.getUTCHours(),e.internal.getUTCMinutes(),e.internal.getUTCSeconds(),e.internal.getUTCMilliseconds()),w(e)}function w(e){const t=r(e.timeZone,e),n=t>0?Math.floor(t):Math.ceil(t),s=new Date(+e);s.setUTCHours(s.getUTCHours()-1);const o=-new Date(+e).getTimezoneOffset(),M=-new Date(+s).getTimezoneOffset(),y=o-M,O=Date.prototype.getHours.apply(e)!==e.internal.getUTCHours();y&&O&&e.internal.setUTCMinutes(e.internal.getUTCMinutes()+y);const l=o-n;l&&Date.prototype.setUTCMinutes.call(e,Date.prototype.getUTCMinutes.call(e)+l);const a=new Date(+e);a.setUTCSeconds(0);const S=o>0?a.getSeconds():(a.getSeconds()-60)%60,h=Math.round(-(r(e.timeZone,e)*60))%60;(h||S)&&(e.internal.setUTCSeconds(e.internal.getUTCSeconds()+h),Date.prototype.setUTCSeconds.call(e,Date.prototype.getUTCSeconds.call(e)+h+S));const u=r(e.timeZone,e),p=u>0?Math.floor(u):Math.ceil(u),Z=-new Date(+e).getTimezoneOffset()-p,$=p!==n,D=Z-l;if($&&D){Date.prototype.setUTCMinutes.call(e,Date.prototype.getUTCMinutes.call(e)+D);const m=r(e.timeZone,e),z=m>0?Math.floor(m):Math.ceil(m),T=p-z;T&&(e.internal.setUTCMinutes(e.internal.getUTCMinutes()+T),Date.prototype.setUTCMinutes.call(e,Date.prototype.getUTCMinutes.call(e)+T))}}class f extends i{static tz(t,...n){return n.length?new f(...n,t):new f(Date.now(),t)}toISOString(){const[t,n,s]=this.tzComponents(),o=`${t}${n}:${s}`;return this.internal.toISOString().slice(0,-1)+o}toString(){return`${this.toDateString()} ${this.toTimeString()}`}toDateString(){const[t,n,s,o]=this.internal.toUTCString().split(" ");return`${t?.slice(0,-1)} ${s} ${n} ${o}`}toTimeString(){const t=this.internal.toUTCString().split(" ")[4],[n,s,o]=this.tzComponents();return`${t} GMT${n}${s}${o} (${N(this.timeZone,this)})`}toLocaleString(t,n){return Date.prototype.toLocaleString.call(this,t,{...n,timeZone:n?.timeZone||this.timeZone})}toLocaleDateString(t,n){return Date.prototype.toLocaleDateString.call(this,t,{...n,timeZone:n?.timeZone||this.timeZone})}toLocaleTimeString(t,n){return Date.prototype.toLocaleTimeString.call(this,t,{...n,timeZone:n?.timeZone||this.timeZone})}tzComponents(){const t=this.getTimezoneOffset(),n=t>0?"-":"+",s=String(Math.floor(Math.abs(t)/60)).padStart(2,"0"),o=String(Math.abs(t)%60).padStart(2,"0");return[n,s,o]}withTimeZone(t){return new f(+this,t)}[Symbol.for("constructDateFrom")](t){return new f(+new Date(t),this.timeZone)}}export{f as T};
